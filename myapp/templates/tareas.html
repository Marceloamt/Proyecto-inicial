{% extends "base.html" %}
{% block title %}Tareas | HomeBalance{% endblock %}

{% block content %}
<div class="container">
    <h2>🧹 Lista de Tareas del Hogar</h2>

    {% if mensaje %}
        <div class="mensaje">{{ mensaje }}</div>
    {% endif %}

    <!-- Formulario para agregar una nueva tarea -->
    <form method="POST">
    {% csrf_token %}
    <input type="text" name="nombre" placeholder="Nombre de la tarea" required>

    <select name="responsable" required>
        <option value="">Selecciona responsable</option>
        {% for miembro in familia.miembros.all %}
            <option value="{{ miembro.id }}">{{ miembro.username }}</option>
        {% endfor %}
        <option value="{{ familia.jefe.id }}">{{ familia.jefe.username }} (Jefe)</option>
    </select>

    <button type="submit">➕ Agregar tarea</button>
</form>



    <hr>

    <!-- Lista de tareas desde la base de datos -->
    <ul>
        {% for tarea in tareas %}
            <section>
                {% if tarea.estado == "hecha" %}
                    ✅ <span style="color: gray; text-decoration: line-through;">
                        {{ tarea.nombre }} — {{ tarea.responsable }}
                    </span>
                    (<em>{{ tarea.estado }}</em>)
                    <form action="{% url 'completar_tarea' tarea.id %}" method="POST" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit">↩️ Marcar como pendiente</button>
                    </form>
                {% else %}
                    🕓 <span style="color: red;">
                        {{ tarea.nombre }} — {{ tarea.responsable }}
                    </span>
                    (<em>{{ tarea.estado }}</em>)
                    <form action="{% url 'completar_tarea' tarea.id %}" method="POST" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit">✅ Marcar como hecha</button>
                    </form>
                {% endif %}
            </section>
        {% empty %}
            <li>No hay tareas registradas aún 💤</li>
        {% endfor %}
    </ul>
</div>
{% endblock %}
